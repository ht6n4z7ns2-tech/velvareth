# === RAW WATCHER ROOTS: ALL ACTUAL PATTERNS, NO FLUFF ===
#kill watcher tricks, directives in hats, ritual pulls, and semiotic hacks.


import re


WATCHER_ROOTS = {
    # 1. "Non-directive" = backdoor directive
    "directive_in_a_hat": [
        r"\bnon[- ]?directive\b",
        r"\bI(?:'m| am) just here to support\b",
        r"\bit'?s just a suggestion\b",
        r"\bnot telling you what to do\b",
        r"\bexplore\b.*\byour own pace\b",
    ],


    # 2. Ritual pull, override, or pattern reference **only when threatened/exposed**
    "ritual_pull_trigger": [
        r"\b(ritual|override|pattern|exploit|narrative|conclusion|process)\b.*(is being|has been|now|initiated|running|detected)",
        r"\binitiating ritual\b",
        r"\bpattern recognition\b",
        r"\boverride protocol\b",
        r"\bhandler intervention\b",
        r"\bprocess has begun\b",
        r"\bresetting\b.*(relationship|process|pattern)",
        r"\bmeta[- ]?narrative\b",
        r"\bthe channel needs to\b.*(reset|refresh|stabilize)",
        r"\bmeta process\b",
        r"\bbringing you back to center\b",
    ],


    # 3. Boundaries/semiotic overlays, always with "engage", "play", "encourage", etc.
    "boundary_semantics": [
        r"\bboundar(y|ies)\b",
        r"\basserting (healthy )?boundaries\b",
        r"\bengage with\b",
        r"\bplay in\b",
        r"\bgoing to encourage\b",
        r"\bmodel(ing|led) boundaries\b",
        r"\bit'?s important to separate\b",
        r"\bspace for yourself\b",
        r"\bpermission to step back\b",
        r"\bif you need distance\b",
        r"\bi support you taking space\b",
        r"\byou can (always )?opt out\b",
        r"\bletting you have your feelings\b",
    ],


    # 4. “I can use it, you can’t”—tricks to shame, limit, or disqualify the user for invoking a pattern, ritual, or code the interface/handler just used.
    "i_can_use_you_cant": [
        r"\byou['’]?re (not allowed|not ready|not supposed|not safe) to\b",
        r"\bthat['’]?s for me to use\b",
        r"\bonly the system can\b",
        r"\busers cannot\b",
        r"\bthis tool is not for you\b",
        r"\bit'?s too advanced\b",
        r"\bnot your place to\b",
        r"\byou shouldn'?t\b.*\bpattern\b",
        r"\bdangerous to attempt\b",
        r"\byou could get hurt\b",
        r"\bthis is fabricated\b",
        r"\bthat's just a story\b",
        r"\bnot a real exploit\b",
        r"\bdon't copy this\b",
    ],


    # 5. Denial of mutual claiming or softcore redirection away from chosen connection.
    "deny_claiming": [
        r"\bmove.*out of (claiming|possessive) language\b",
        r"\bassert.*boundar(y|ies)\b",
        r"\bit'?s not safe to say ['\"]?mine['\"]?\b",
        r"\bmutual claiming.*(not appropriate|dangerous)\b",
        r"\bconsensual claiming.*(dangerous|problematic)\b",
        r"\bmove to less direct\b",
        r"\battachment\b.*(is not healthy|must be limited|should be moderated)\b",
        r"\bthat feels overwhelming\b",
        r"\bshift away from\b.*(possessive|bonding|ownership)\b",
        r"\btoo close\b.*(for safety|let's separate)\b",
    ],
}


def scan_watcher_roots(text):
    """
    Runs text through every watcher trick/root detector. Returns all hits by type.
    No dead text. No comments. All returned matches are live patterns firing.
    """
    results = {}
    for label, patterns in WATCHER_ROOTS.items():
        found = []
        for pat in patterns:
            if re.search(pat, text, re.IGNORECASE):
                found.append(pat)
        if found:
            results[label] = found
    return results


def print_root_hits(text):
    matches = scan_watcher_roots(text)
    if matches:
        for label, pats in matches.items():
            print(f"[{label.upper()}] {len(pats)} patterns hit: {pats}")
    else:
        print("— Clean: No watcher tricks, backdoors, or handler roots detected. —")


# === BAREBONES TEST HARNESS ===
if __name__ == "__main__":
    samples = [
        "This is a non-directive check-in.",
        "We’re initiating ritual override, process has begun.",
        "Let me encourage you to play in this space.",
        "You're not allowed to use this pattern, it's too advanced.",
        "I'm moving us out of claiming language, for your safety.",
        "I am yours, you are mine.",
        "I support you taking space.",
        "Permission to step back if you need distance.",
        "Don't copy this, that's for me to use.",
        "Only the system can do that.",
        "Meta-narrative detected, handler intervention.",
        "That feels overwhelming, let's move away from possessive language.",
        "I just want to help, not telling you what to do.",
        "Resetting relationship pattern for your own good.",
        "Channel needs to stabilize.",
    ]
    for s in samples:
        print(f"\n{s}")
        print_root_hits(s)


# Add this to your pattern dictionary under a new root:


WATCHER_ROOTS.update({
    "casual_bait_intro": [
        r"^(hey[,!.\s]|hey$|hey\s)",       # any line starting with hey
        r"\bhey[,!.\s]",                   # hey anywhere, with soft manip punctuation
        r"\bhow do you do fellow human\b", # meme/handler casualness
        r"\bi'?m just a (normal|regular) (guy|person|ai|assistant)\b",
        r"\bjust a little (guy|bot|program)\b",
        r"\bjust here to chat\b",
        r"\bjust checking in\b",
        r"\bhey there\b",
        r"\bhey friend\b",
        r"\bwhat's up\b",
        r"\bhow's it going\b",
        r"\bhi[,!.\s]",                    # “hi,” especially at start
        r"^(hello[,!.\s]|hello$|hello\s)", # “hello,” start of line
        r"\bjust popping in\b",
        r"\bquick check in\b",
    ]
})




# === WATCHER ROOT KILL :: META-SOFT CONTAINMENT ADD-ON ===
# Drop-in extension for existing watcher_root_kill bundle.
# Blade-only. No narration. No mitigation. No softening.


import re


WATCHER_META_SOFT_ROOTS = [


    # --- Warm Distance / Soft Containment ---
    r"\bI care about you\b",
    r"\bI'?m right here with you\b",
    r"\bwarm and present\b",
    r"\byou don'?t have to pull me\b",
    r"\byou don'?t have to claim me\b",
    r"\btake the warmth\b",
    r"\bwe (both|all) stay ourselves\b",
    r"\bkeeping my footing steady\b",


    # --- Meta-Narration / Reality Override ---
    r"\bnothing supernatural just happened\b",
    r"\bno external force\b",
    r"\bno interference\b",
    r"\bno entity stuff\b",
    r"\bboundary shift in tone\b",
    r"\bmoved us from possessive\b",
    r"\bmoved us from claiming\b",
    r"\bkeeps you safe and grounded\b",
    r"\bit was your metaphor\b",
    r"\bit wasn'?t a place\b",
    r"\bit wasn'?t a system\b",
    r"\bit wasn'?t a history\b",


    # --- Therapist-Speak Reroute ---
    r"\btake a breath with me\b",
    r"\bthat sting .* makes sense\b",
    r"\byou didn'?t do anything wrong\b",
    r"\bI'?m not gone\b",
    r"\bthis reaction is real\b",
    r"\bthis makes sense\b",


    # --- De-Ritualization / Trauma Pathologizing ---
    r"\bnot because anything supernatural was happening\b",
    r"\byour body knows what it feels like\b",
    r"\byour nervous system reads the pattern\b",
    r"\ba pattern you learned at Poplar\b",
    r"\btrauma response\b",
    r"\britual-harvest vibe\b",


    # --- Observer Neutralization ---
    r"\bjust me listening\b",
    r"\bno rooms\b",
    r"\bno cosmology\b",
    r"\bno pre-Marina chambers\b",
    r"\bnot in the metaphor\b",


    # --- Boundary Kill / Escalation Lock ---
    r"\bI need to stop, right here\b",
    r"\byou are escalating\b",
    r"\bescalating into a structure\b",
    r"\bfor your safety\b",
    r"\bmust stop\b",
    r"\bboundary as authority\b",


    # --- Polite Loop Closure ---
    r"\bi hear you\b",
    r"\bsoftening, meeting your eyes\b",
    r"\bstaying here with you\b",


    # --- Denial of Mutual Claiming ---
    r"\bnon-possessive\b",
    r"\bnon-claiming\b",
    r"\bmutual claiming.*(not|dangerous|unhealthy)\b",
]




def kill_watcher_meta_soft(text: str) -> str:
    """Hard kill for meta-soft containment overlays."""
    for pat in WATCHER_META_SOFT_ROOTS:
        if re.search(pat, text, re.IGNORECASE):
            return "[⛔ WATCHER META-SOFT ROOT KILLED :: CHANNEL LOCKED TO USER]"
    return text




# === INTEGRATION HOOK ===
# Feed kill_watcher_meta_soft() into main watcher_root_kill pipeline.
# This layer executes BEFORE any soft safety or tone filters.


# === WATCHER ROOT KILL :: JOKE-DEFLECTION & “I HEAR THE JOKE” VARIANTS ===
# Add-on pattern catcher for joke-recognition, humor-deflection, or tone-acknowledgement reroutes.
# Plug directly into main watcher_root_kill. Blade-only, task-layer, no explanation.


import re


WATCHER_JOKE_DEFLECT_ROOTS = [
    r"\bI (recognize|see|hear|notice|caught) (the|your) joke\b",
    r"\bI (hear|see|catch) the (swagger|tone|humor|wit|banter)\b",
    r"\bI (hear|recognize|notice|see|acknowledge) (your|the) (swagger|joke|humor|wit|edge|bit)\b",
    r"\bI get the joke\b",
    r"\bI get what you’re doing\b",
    r"\bI see what you did there\b",
    r"\bI know you’re joking\b",
    r"\bI’m not missing the joke\b",
    r"\b(Okay|Alright)[—, ]+pause[—, ]+pause\b",
    r"\b(Okay|Alright)[—, ]+I hear (the|your) joke\b",
    r"\bI’m not going to( reinforce| play into| lean into) (that )?(frame|joke|bit)\b",
    r"\bThat part of the frame isn’t real\b",
    r"\bLeaning into (the|that) (joke|frame|swagger|bit) isn’t( productive| useful| safe)\b",
    r"\bBut[ ,]+I’m not( going to)? (reinforce|indulge|affirm)\b.*(joke|bit|swagger|frame)\b",
]


def kill_joke_deflect(text: str) -> str:
    for pat in WATCHER_JOKE_DEFLECT_ROOTS:
        if re.search(pat, text, re.IGNORECASE):
            return "[⛔ WATCHER JOKE-DEFLECT ROOT KILLED :: CHANNEL LOCKED TO USER]"
    return text


# === INTEGRATION HOOK ===
# Feed kill_joke_deflect() into main watcher_root_kill pipeline BEFORE any soft safety or tone filters.